# 17.多种类型的身份鉴别机制
+ What you know(口令)
   + 口令激活PKI（容易遭受攻击，对服务器安全更加敏感）
      + 虚拟软令牌
         + 私钥用口令加密，被加密的私钥存放于服务器，使用时通过口令验证身份，协商会话秘钥，获得数据解密得私钥。
      + 虚拟智能卡
         + d=d1+d2。d1是用户口令，d2是存储在服务器上的秘密元素。
         + 使用时用户通过口令向服务器验证身份，双方协商会话秘钥
         + 服务器端：c2=m^(d2)mod N，并将其发送给用户
         + 用户端：c=c2 ^(d1)=m^(d1)mod N=m^(d)mod
   + 基于手机密码模块——将用户部分存放至手机中
+ What you have（USB KEY、TOKEN、手机验证）
+ What you are（生物特征）
+ Mixed（多因素身份鉴别）
   + 其安全性不能低于通常情况下的鉴别机制
+ somebody you know（紧急鉴别）
# 18.OAuth &OpenId
### 18.1 单点登录（SSO）
+ Kerberos--典型的单点登录 
+ SAML
### 18.2 OAuth--授权（openId的基础）基于非对称、签名
+ Abstract Protocol Flow（此处应该有图）
   1. client向resource owner发出authorization request，返回authorization grant。
   2. client向authorization server发出authorization grant，返回access token。
   3. client向resource server发出access token，返回protected server。
+ [Authorization code Flow](https://github.com/iaojun/course/blob/master/picture/authorization_code_flow.png/)(此处有图)
   1. A:client重定向resource owner的user-agent到authorization终端。
   2. C:authorization server使用前面提供的重定向URI将user-agent重定向回client。重定向URI包括一个authorization code和client先前提供的本地状态。
   3. D:client通过authorization code从authorization server的令牌端点请求访问令牌。在发出请求时，client将使用授权服务器进行身份验证。 
   4. E：授权服务器使用访问令牌和刷新令牌（可选）进行响应。授权服务器对客户端进行身份验证，验证授权代码，并确保收到的重定向URI与步骤（c）中用于重定向客户端的URI匹配。 
   5. [实例图](https://github.com/iaojun/course/blob/master/picture/Alice_authorization.png/)
+ CSRF攻击
### 18.3 OpenId--鉴别、认证
1. [授权码鉴别](https://github.com/iaojun/course/blob/master/picture/OPENID_2.png)
   + [实例图](https://github.com/iaojun/course/blob/master/picture/OPENID_1.png/)
   + 所有令牌从令牌端点获得
2. [隐式鉴别](https://github.com/iaojun/course/blob/master/picture/OPENID_3.png)
   + 所有令牌从授权端点获得
3. 混合鉴别
4. 以上3种区别就是依赖方获得令牌方式不同。
5. 身份验证信息的返回包含在ID令牌中。
# 19.Eduroam
1. 定义：专为科研院所和学校开发的全球无限漫游认证服务。
2. Eduroam协议过程
   + EAP（可扩展鉴别协议）--由于实体之间通信协议不同，但都支持这种鉴别协议。
   + 移动设备和AP(无线热点)之间通信采用802.1x协议，AP和服务器、服务器和服务器之间通信采用RADIUS协议。AP作为两种协议的中继，使鉴别服务器和移动终端之间建立EAP逻辑信道。
3. EAP协议实现方法---EAP-TTLS协议。
   + TLS握手阶段---鉴别服务器和移动终端之间的TLS隧道
   + 隧道内通信阶段---用户身份鉴别（移动终端直接将用户名和口令明文发送给鉴别服务器）
   + 具体过程：EAP请求由AP发起，之后AP仅转发EAP数据包以及判断EAP协议是否结束。移动终端和鉴别服务器进行完整的TLS协商。最后鉴别服务器发送成功或者失败的EAP数据包以表示EAP协议的结束。
4. 使用DNS树。
   + 保证RADIUS数据包能从用户访问机构的服务器到达用户所处机构的服务器。将用户身份发送给用户所在机构验证其身份。
# 20.FIDO（Fast Identity Online）
+ 对于移动终端安全性的不信任
+ 在服务器端将用户与移动终端的可信环境进行身份绑定，将用户与服务器之间的直接鉴别转变为两段式鉴别：移动终端鉴别用户，网络鉴别移动终端。
+ 典型方案：FIDO、IFAA
### UAF(Universal Authentication Framework)
+ 无密码、多因素认证
### U2F(Universal 2nd Factor)
+ 第二因素
### 过程
+ 注册：用户用生物信息等解锁FIDO鉴别器，用户设备产生公私钥对，将公钥发送给服务器，服务器将公钥和用户信息绑定。
+ 登录：客户端选择用户生物身份信息对应的私钥发送签名消息，服务器用相应的公钥验证。
# 21.PKI信任机制的安全增强方案
1. 证书透明化：引入CT，以审计CA
2. 限制CA权力（签发的能力）
   + Certlock:TLS服务器只会向同一个国家申请证书。记录访问时证书的CA信息，再次登录不同时比较CA国家，不同则警告
   + Cage:限制CA可以签发的顶级域名（CA签发范围的限定规则：CA在相应的顶级域名中至少签发过一个证书）
   + DANE：为DNS中的数据增加数字签名
       + DNS相关概念：DNS是以域名为索引的，关于主机信息的分布式数据库
   + CAA:是事前的，用以签发证书之前CA的检查
3. 浏览器端实施检测（判断是否为虚假证书）




